(function(){WebSocketRails.AbstractConnection=function(){function t(t,e){this.dispatcher=e,this.message_queue=[]}return t.prototype.close=function(){},t.prototype.trigger=function(t){return"connected"!==this.dispatcher.state?this.message_queue.push(t):this.send_event(t)},t.prototype.send_event=function(t){if(null!=this.connection_id)return t.connection_id=this.connection_id},t.prototype.on_close=function(t){var e;if(this.dispatcher&&this.dispatcher._conn===this)return e=new WebSocketRails.Event(["connection_closed",t]),this.dispatcher.state="disconnected",this.dispatcher.dispatch(e)},t.prototype.on_error=function(t){var e;if(this.dispatcher&&this.dispatcher._conn===this)return e=new WebSocketRails.Event(["connection_error",t]),this.dispatcher.state="disconnected",this.dispatcher.dispatch(e)},t.prototype.on_message=function(t){if(this.dispatcher&&this.dispatcher._conn===this)return this.dispatcher.new_message(t)},t.prototype.setConnectionId=function(t){this.connection_id=t},t.prototype.flush_queue=function(){var t,e,n,i;for(e=0,n=(i=this.message_queue).length;e<n;e++)t=i[e],this.trigger(t);return this.message_queue=[]},t}()}).call(this);